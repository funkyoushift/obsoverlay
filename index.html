<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FunkYouSHiFT Overlay</title>

<link rel="preconnect" href="https://streamlabs.com" crossorigin>
<link rel="dns-prefetch" href="https://streamlabs.com">
<link rel="preconnect" href="https://throne.com" crossorigin>
<link rel="dns-prefetch" href="https://throne.com">

<style>
:root{
  --ink:#070707;
  --panel:rgba(6,6,6,.78);
  --pad:24px;

  /* layout knobs (URL overrides supported) */
  --headerTop:24px;   /* &headerTop=100 to clear marquee */
  --headerH:80px;     /* auto-measured by JS */
  --chatW:900px;      /* now: RIGHT column width (ticker) */

  /* remaining widgets */
  --tickerH:72px;     /* &tickerH=80 */
  --throneH:180px;    /* &throneH=190 */
}

/* base */
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:transparent;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
.overlay{position:relative;height:100vh;width:100vw}

/* header (make transparent by uncommenting block at bottom if desired) */
.header{
  position:absolute;left:var(--pad);right:var(--pad);top:var(--headerTop);
  background:rgba(0,0,0,.65);padding:12px 20px;border-radius:18px;outline:3px solid var(--ink);
  display:flex;gap:16px;align-items:center;z-index:30
}
.brand{font-weight:1000;font-size:44px;white-space:nowrap}
.header-right{margin-left:auto;display:flex;gap:14px;align-items:center}

/* panels */
.panel{background:var(--panel);backdrop-filter:blur(6px);border-radius:20px;outline:3px solid var(--ink);box-shadow:0 12px 30px rgba(0,0,0,.45)}
.card{position:relative;overflow:hidden}
.card>iframe{position:absolute;inset:0;width:100%;height:100%;border:0}

/* RIGHT: donation/tip ticker */
.tickerOnly{
  position:absolute;right:var(--pad);
  top:calc(var(--headerTop) + var(--headerH));
  width:var(--chatW);height:var(--tickerH);
  z-index:40;
}

/* LEFT: Throne row (not clipped) */
.throne{
  position:absolute;left:var(--pad);
  right:calc(var(--pad) + var(--chatW) + var(--pad));
  top:calc(var(--headerTop) + var(--headerH) + 8px);
  height:var(--throneH);z-index:22
}
.throne.panel.card{overflow:visible}

/* GOALS footer (left) */
.footer{
  position:absolute;left:var(--pad);
  right:calc(var(--pad) + var(--chatW) + var(--pad));
  bottom:var(--pad);
  height:170px;display:grid;grid-template-columns:1fr 1fr;gap:20px;z-index:20
}

/* scene layer */
.scene{position:absolute;inset:0;display:none;place-items:center;pointer-events:none;z-index:25}
.scene[open]{display:grid}
.scene .box{padding:28px 40px;border-radius:22px;background:rgba(0,0,0,.28);outline:3px solid var(--ink)}
.title{font:1000 180px/1 system-ui;text-transform:uppercase;text-align:center;text-shadow:0 6px 0 #000,0 16px 42px rgba(0,0,0,.85)}
.sub{font:700 48px system-ui;text-align:center;text-shadow:0 3px 8px rgba(0,0,0,.9)}
.cd{font:1000 92px system-ui;text-align:center;margin-top:8px}
.hidden{display:none}

/* (optional) make header fully transparent
.header{ background:transparent !important; outline:none !important; box-shadow:none !important; padding:0 !important }
*/
</style>
</head>
<body>
<div class="overlay">
  <!-- header -->
  <div class="header" role="banner" aria-label="Overlay Header">
    <div id="brand" class="brand">FUNKYOUSHIFT</div>
    <div class="header-right"></div>
  </div>

  <!-- RIGHT: donation/tip ticker only -->
  <div class="tickerOnly panel card" aria-label="Donation Ticker">
    <iframe id="don" title="Donation Ticker" aria-label="Donation Ticker" loading="eager"
      referrerpolicy="no-referrer"
      sandbox="allow-scripts allow-same-origin allow-popups allow-forms"></iframe>
  </div>

  <!-- LEFT: Throne + Goals -->
  <div class="throne panel card" aria-label="Throne Featured Item">
    <iframe id="throne" title="Throne" aria-label="Throne Featured Item" loading="eager"
      referrerpolicy="no-referrer"
      sandbox="allow-scripts allow-same-origin allow-popups allow-forms"></iframe>
  </div>

  <div class="footer" aria-label="Goals">
    <div class="panel card" aria-label="Sub Goal">
      <iframe id="sub" title="Sub Goal" aria-label="Sub Goal" loading="eager"
        referrerpolicy="no-referrer"
        sandbox="allow-scripts allow-same-origin allow-popups allow-forms"></iframe>
    </div>
    <div class="panel card" aria-label="Follower Goal">
      <iframe id="fol" title="Follower Goal" aria-label="Follower Goal" loading="eager"
        referrerpolicy="no-referrer"
        sandbox="allow-scripts allow-same-origin allow-popups allow-forms"></iframe>
    </div>
  </div>

  <!-- scene layer -->
  <div id="layer" class="scene" aria-hidden="true">
    <div class="box">
      <div id="t" class="title">STARTING SOON</div>
      <div id="s" class="sub">Grab a snack. We go live in…</div>
      <div id="c" class="cd hidden">10:00</div>
    </div>
  </div>
</div>

<script>
/* widget defaults (Spotify & Viewer & Chat removed) */
const DEFAULTS = {
  subUrl:      "https://streamlabs.com/widgets/sub-goal?token=7B7657C5393C19BA008816799794608699B0A8EB5AB5FC821A45C79FAD70D3F30FC56EE70771A6970EFF29A897CEF86B54FD29F8EE831EB045DC9FC3BA62AFCDA2F397758D62664EDA89F83AB418470EB8014E2A08D13FF8128DC7F8C3E7F809D8B44A555DD2EF7C601BC17F0DA2208E3E4E99481EAADED7E2FF528FED",
  followerUrl: "https://streamlabs.com/widgets/follower-goal?token=7B7657C5393C19BA008816799794608699B0A8EB5AB5FC821A45C79FAD70D3F30FC56EE70771A6970EFF29A897CEF86B54FD29F8EE831EB045DC9FC3BA62AFCDA2F397758D62664EDA89F83AB418470EB8014E2A08D13FF8128DC7F8C3E7F809D8B44A555DD2EF7C601BC17F0DA2208E3E4E99481EAADED7E2FF528FED",
  throneUrl:   "https://throne.com/featured-item-overlay/twitch:492630829",
  donationUrl: "https://streamlabs.com/widgets/donation-ticker?token=7B7657C5393C19BA008816799794608699B0A8EB5AB5FC821A45C79FAD70D3F30FC56EE70771A6970EFF29A897CEF86B54FD29F8EE831EB045DC9FC3BA62AFCDA2F397758D62664EDA89F83AB418470EB8014E2A08D13FF8128DC7F8C3E7F809D8B44A555DD2EF7C601BC17F0DA2208E3E4E99481EAADED7E2FF528FED",
  brand:       "FUNKYOUSHIFT"
};

/* URL params -> CSS vars */
const q = new URLSearchParams(location.search);
const get = (k) => q.get(k) || DEFAULTS[k] || "";
document.getElementById("brand").textContent = get("brand");

const setVar = (k,v) => v && document.documentElement.style.setProperty(k, /px$|%$|vh$|vw$/.test(v)? v : v+'px');
['chatW','tickerH','throneH','headerTop'].forEach(v => setVar('--'+v, q.get(v) || ''));

/* measure real header height so stacking is correct */
const measureHeader = () => {
  const el = document.querySelector('.header');
  if (!el) return;
  const h = Math.ceil(el.getBoundingClientRect().height);
  document.documentElement.style.setProperty('--headerH', h + 'px');
};
measureHeader(); addEventListener('resize', measureHeader);

/* small cache-buster so OBS doesn't keep stale widgets */
const withBust = (url) => {
  try { const u = new URL(url); u.searchParams.set('_v', Date.now()); return u.toString(); }
  catch { return url; }
};

/* set embeds (hide panel if missing) */
function setSrc(id, url){
  const el = document.getElementById(id);
  if(!el){ return; }
  if(!url){ el.closest('.card')?.classList.add('hidden'); el.src = 'about:blank'; return; }
  el.src = withBust(url);
}
setSrc('sub',     get('subUrl'));
setSrc('fol',     get('followerUrl'));
setSrc('throne',  get('throneUrl'));
setSrc('don',     get('donationUrl'));

/* optional: starting scene (use ?scene=starting&cd=600) */
const layer = document.getElementById('layer'),
      title = document.getElementById('t'),
      sub   = document.getElementById('s'),
      cd    = document.getElementById('c');
const scene = (q.get("scene") || "main").toLowerCase();

function showLayer(on){ layer.toggleAttribute('open', !!on); layer.setAttribute('aria-hidden', on? 'false':'true'); }

if(scene==='starting'){
  showLayer(true);
  title.textContent = 'STARTING SOON';
  sub.textContent   = 'Grab a snack. We go live in…';
  const cdStr = q.get('cd');
  if(cdStr){
    cd.classList.remove('hidden');
    let t = Math.max(0, parseInt(cdStr,10) || 0);
    const fmt = n => String(n).padStart(2,'0');
    (function tick(){ const m=Math.floor(t/60), s=t%60;
      cd.textContent = `${fmt(m)}:${fmt(s)}`;
      if(t>0){ t--; setTimeout(tick,1000); }
    })();
  }
}
</script>
</body>
</html>
